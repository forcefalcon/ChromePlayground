<!DOCTYPE html>
<html>
  <!--
  Copyright (c) 2012 The Chromium Authors. All rights reserved.
  Use of this source code is governed by a BSD-style license that can be
  found in the LICENSE file.
  -->
<head>
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="-1" />
  <title>File Histogram.</title>
  <script type="text/javascript" src="common.js"></script>
  <script type ="text/javascript" >
    function postFileContents(file) {
      var reader = new FileReader();
      reader.onload = function(load_event) {
        if (naclModule)
          naclModule.postMessage(load_event.target.result);
      }
      reader.readAsArrayBuffer(file);
    }

    // Handle a file being dropped on to the plugin's rectangle.
    function handleFileDrop(dropEvent) {
      if (!dropEvent.dataTransfer || !dropEvent.dataTransfer.files)
        return;
      dropEvent.stopPropagation();
      dropEvent.preventDefault();
      var files = dropEvent.dataTransfer.files;
      for(var i = 0; i < files.length; ++i)
        postFileContents(files[i]);
    }

    // Handle a file being chosen from the <input type=file...> tag.
    function handleFileInput() {
      var file_input = document.getElementById("FileInput");
      var files = file_input.files;
      for(var i = 0; i < files.length; ++i)
        postFileContents(files[i]);
      return false;
    }
  </script>

</head>
<body onload="pageDidLoad('file_histogram', 'newlib', 256, 256)">

<h1>Native Client Simple Module</h1>
<h2>Status: <code id="statusField">NO-STATUS</code></h2>
  <!-- The <EMBED> element is wrapped inside a <DIV>, which has both a 'load'
  and a 'message' event listener attached.  This wrapping method is used
  instead of attaching the event listeners directly to the <EMBED> element to
  ensure that the listeners are active before the NaCl module 'load' event
  fires.  This also allows you to use PPB_Messaging.PostMessage() (in C) or
  pp::Instance.PostMessage() (in C++) from within the initialization code in
  your NaCl module. 
  
  The src points to a manifest file, which provides the Native Client plug-in
  a mapping between architecture and NaCl Executable (NEXE). 
  
  We use a non-zero sized embed to give Chrome space to place the bad plug-in
  graphic, if there is a problem.
  -->
  <div id="listener">
    <script type="text/javascript">
      var listener = document.getElementById('listener');
      listener.addEventListener('load', moduleDidLoad, true);
      listener.addEventListener('message', handleMessage, true);
      listener.addEventListener('drop', handleFileDrop, true);
    </script>
    <form name="FileInput"
          action=""
          method=""
          onsubmit="return handleFileInput()">
      <input type="file"
             id="FileInput"
             onchange="this.form.onsubmit()"
             multiple>
    </form>
  </div>
</body>
</html>
